<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DShinee Profile</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root { --bg-color: #0f172a; --glass-bg: rgba(15, 23, 42, 0.7); --glass-border: rgba(56, 189, 248, 0.15); --primary: #0ea5e9; --text-main: #f0f9ff; --text-sub: #bae6fd; --gradient: linear-gradient(135deg, #06b6d4 0%, #3b82f6 100%); --accent-cyan: #06b6d4; }
        * { margin: 0; padding: 0; box-sizing: border-box; scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--bg-color); background-image: radial-gradient(at 0% 0%, rgba(6, 182, 212, 0.15) 0, transparent 50%), radial-gradient(at 50% 0%, rgba(59, 130, 246, 0.15) 0, transparent 50%), radial-gradient(at 100% 0%, rgba(15, 23, 42, 1) 0, transparent 50%); background-attachment: fixed; color: var(--text-main); overflow-x: hidden; }
        #snowCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; pointer-events: none; }
        
        /* --- PHẦN TOAST MESSAGE ĐÃ ĐƯỢC SỬA --- */
        #toast-msg { 
            position: fixed; top: -100px; left: 50%; transform: translateX(-50%); 
            background: linear-gradient(135deg, #ef4444, #b91c1c); /* Màu đỏ (Mặc định/Lỗi) */
            color: white; padding: 12px 30px; border-radius: 50px; 
            box-shadow: 0 10px 30px rgba(239, 68, 68, 0.4); z-index: 99999; 
            transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); font-weight: 600; 
            border: 1px solid rgba(255, 255, 255, 0.2); white-space: nowrap; 
            font-size: 0.95rem; pointer-events: none; text-align: center; 
        }
        /* Class màu xanh lá cho trạng thái thành công */
        #toast-msg.success {
            background: linear-gradient(135deg, #22c55e, #15803d) !important;
            box-shadow: 0 10px 30px rgba(34, 197, 94, 0.4) !important;
        }
        #toast-msg.show { top: 30px; }
        /* -------------------------------------- */

        .fixed-menu { position: fixed; top: 20px; right: 25px; z-index: 2000; }
        .hamburger-btn { font-size: 1.5rem; color: var(--text-main); cursor: pointer; padding: 10px 14px; transition: 0.3s; border-radius: 12px; background: rgba(15, 23, 42, 0.4); backdrop-filter: blur(5px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .hamburger-btn:hover { background: rgba(56, 189, 248, 0.3); color: var(--accent-cyan); border-color: var(--accent-cyan); }
        .nav-dropdown { position: absolute; top: 100%; right: 0; margin-top: 15px; background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border: 1px solid var(--glass-border); border-radius: 15px; padding: 15px; min-width: 180px; display: none; flex-direction: column; gap: 10px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); transform-origin: top right; animation: menuFadeIn 0.3s ease; }
        .nav-dropdown.active { display: flex; }
        .nav-dropdown a { color: var(--text-sub); text-decoration: none; font-size: 0.95rem; padding: 10px 15px; border-radius: 10px; transition: 0.3s; text-align: right; display: block; }
        .nav-dropdown a:hover { background: var(--gradient); color: white; transform: translateX(-5px); }
        @keyframes menuFadeIn { from { opacity: 0; transform: scale(0.9); } to { opacity: 1; transform: scale(1); } }
        .container { max-width: 800px; margin: 0 auto; padding: 100px 20px 50px; }
        section { margin-bottom: 60px; opacity: 0; transform: translateY(50px); transition: all 0.8s ease-out; }
        section.visible { opacity: 1; transform: translateY(0); }
        .glass-card { background: var(--glass-bg); backdrop-filter: blur(16px); border: 1px solid var(--glass-border); border-radius: 20px; padding: 30px; box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.6); }
        .hero { text-align: center; padding-top: 20px; }
        .avatar-box { width: 150px; height: 150px; margin: 0 auto 20px; padding: 4px; border-radius: 50%; background: var(--gradient); box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); }
        .avatar { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; border: 4px solid var(--bg-color); }
        .hero h1 { font-size: 2.5rem; margin-bottom: 5px; background: var(--gradient); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .hero p { color: var(--text-sub); font-size: 1.1rem; margin-bottom: 20px; }
        .social-links { display: flex; justify-content: center; gap: 15px; }
        .social-btn { width: 45px; height: 45px; border-radius: 12px; background: rgba(56, 189, 248, 0.1); display: flex; align-items: center; justify-content: center; color: var(--text-sub); text-decoration: none; transition: 0.3s; font-size: 1.2rem; position: relative; overflow: hidden; }
        .social-btn:hover { background: var(--gradient); color: #fff; transform: translateY(-3px); box-shadow: 0 0 15px rgba(6, 182, 212, 0.4); }
        .section-title { font-size: 1.5rem; margin-bottom: 20px; border-left: 4px solid var(--accent-cyan); padding-left: 15px; color: #fff; }
        .install-btn { display: inline-flex; align-items: center; gap: 10px; padding: 12px 28px; background: var(--gradient); color: #fff!important; text-decoration: none; border-radius: 12px; font-weight: 600; font-size: 0.95rem; transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 4px 15px rgba(6, 182, 212, 0.3); border: none; outline: none; cursor: pointer; }
        .install-btn:hover { transform: translateY(-3px) scale(1.02); box-shadow: 0 8px 25px rgba(6, 182, 212, 0.5); filter: brightness(1.1); }
        .install-btn.sm { padding: 8px 20px; font-size: 0.85rem; margin-top: 15px; background: rgba(56, 189, 248, 0.1); border: 1px solid var(--glass-border); }
        .install-btn.sm:hover { background: var(--gradient); }
        @keyframes pulse-cyan { 0% { box-shadow: 0 0 0 0 rgba(0, 211, 222, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(0, 211, 222, 0); } 100% { box-shadow: 0 0 0 0 rgba(0, 211, 222, 0); } }
        @keyframes float-up { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-6px); } }
        .btn-effect { position: relative; overflow: hidden; transition: all 0.5s ease; animation: float-up 3s ease-in-out infinite, pulse-cyan 2s infinite; }
        .btn-effect:hover { transform: scale(1.05); animation-play-state: paused; box-shadow: 0 10px 25px rgba(168, 85, 247, 0.5); filter: brightness(1.2) hue-rotate(15deg); }
        .btn-effect::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle, rgba(255, 255, 255, 0.3) 0%, transparent 60%); opacity: 0; transform: scale(0.5); transition: all 0.5s ease; }
        .btn-effect:hover::before { opacity: 1; transform: scale(1); }
        .btn-effect i { text-shadow: 0 0 5px rgba(255, 255, 255, 0.6); transition: all 0.5s; }
        .btn-effect:hover i { text-shadow: 0 0 15px white; }
        #donateArea { display: none; margin-top: 20px; animation: fadeInUp 0.5s forwards; }
        .qr-card { background: rgba(255, 255, 255, 0.05); border-radius: 15px; padding: 20px; border: 1px solid var(--glass-border); display: inline-block; width: 100%; max-width: 320px; }
        .qr-img { width: 100%; border-radius: 10px; margin-bottom: 15px; transition: 0.3s; }
        .bank-info { text-align: left; background: rgba(14, 165, 233, 0.1); padding: 15px; border-radius: 10px; }
        .bank-item { font-size: 0.85rem; margin-bottom: 5px; color: var(--text-sub); }
        .bank-item b { color: var(--accent-cyan); }
        .skills-grid { display: flex; flex-wrap: wrap; gap: 10px; }
        .skill-tag { padding: 8px 16px; background: rgba(56, 189, 248, 0.05); border-radius: 30px; font-size: 0.9rem; border: 1px solid var(--glass-border); cursor: default; transition: 0.3s; color: var(--text-sub); }
        .skill-tag:hover { background: rgba(6, 182, 212, 0.2); border-color: var(--accent-cyan); color: #fff; box-shadow: 0 0 10px rgba(6, 182, 212, 0.2); }
        #dnsVideoStage, #addConfigStage, #srVideoStage, #usernameFlow { display: none; width: 100%; animation: fadeInUp 0.5s forwards; text-align: center; }
        .status-text { font-size: 0.85rem; color: var(--accent-cyan); margin: 15px 0; display: block; font-style: italic; }
        .video-wrapper { width: 100%; margin-top: 20px; border-radius: 15px; overflow: hidden; border: 1px solid var(--glass-border); display: block; background: #000; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.6); backdrop-filter: blur(8px); display: none; align-items: center; justify-content: center; z-index: 1000; transition: 0.3s; }
        .modal-content { width: 90%; max-width: 350px; text-align: center; padding: 40px 20px; position: relative; }
        .modal-content h3 { margin-bottom: 25px; margin-top: 10px; font-size: 1.2rem; }
        .key-input { width: 100%; padding: 12px; margin-bottom: 15px; border-radius: 10px; border: 1px solid var(--glass-border); background: rgba(255, 255, 255, 0.05); color: #fff; font-family: monospace; text-align: center; outline: none; }
        .key-input:focus { border-color: var(--accent-cyan); }
        .modal-btn-group { display: flex; gap: 10px; justify-content: center; }
        .modal-btn { padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer; font-weight: 600; transition: 0.3s; font-size: 0.85rem; }
        .btn-confirm { background: var(--gradient); color: white; }
        .btn-cancel { background: rgba(255, 255, 255, 0.1); color: var(--text-sub); }
        #popupError { color: #ef4444; font-size: 0.75rem; margin-bottom: 10px; display: none; }
        .music-player { display: flex; align-items: center; gap: 20px; flex-wrap: wrap; justify-content: center; }
        .disk { width: 80px; height: 80px; border-radius: 50%; flex-shrink: 0; background: url('https://avatar-ex-swe.nixcdn.com/song/2021/05/13/2/5/f/3/1620894286595_640.jpg') center/cover; border: 3px solid rgba(255, 255, 255, 0.1); animation: spin 6s linear infinite paused; box-shadow: 0 0 15px rgba(6, 182, 212, 0.3); transition: transform 0.5s; }
        .player-info { flex: 1; display: flex; flex-direction: column; justify-content: center; min-width: 200px; }
        .song-info h3 { font-size: 1.1rem; margin-bottom: 2px; color: #fff; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .song-info p { color: var(--text-sub); font-size: 0.85rem; margin-bottom: 10px; }
        .progress-container { width: 100%; height: 5px; background: rgba(255, 255, 255, 0.1); border-radius: 5px; cursor: pointer; margin-bottom: 5px; position: relative; }
        .progress-bar { width: 0%; height: 100%; background: var(--gradient); border-radius: 5px; position: relative; box-shadow: 0 0 10px var(--accent-cyan); transition: width 0.1s linear; }
        .time-box { display: flex; justify-content: space-between; font-size: 0.75rem; color: var(--text-sub); font-family: monospace; }
        .controls { display: flex; gap: 10px; align-items: center; }
        .control-btn { width: 45px; height: 45px; border-radius: 50%; border: none; cursor: pointer; background: var(--gradient); color: white; font-size: 1.1rem; display: flex; align-items: center; justify-content: center; transition: 0.2s; box-shadow: 0 0 10px rgba(6, 182, 212, 0.4); flex-shrink: 0; }
        .control-btn:active { transform: scale(0.9); }
        .control-btn.secondary { width: 35px; height: 35px; background: rgba(255, 255, 255, 0.1); font-size: 0.9rem; }
        footer { text-align: center; padding: 40px; color: var(--text-sub); font-size: 0.9rem; }
        @media(max-width: 600px) { .container { padding: 80px 15px 30px; } .glass-card { padding: 20px; } .hero h1 { font-size: 2rem; } }
        @keyframes fadeInUp { to { opacity: 1; transform: translateY(0); } }
        @keyframes spin { 100% { transform: rotate(360deg); } }
        .ripple { position: absolute; background: rgba(6, 182, 212, 0.5); border-radius: 50%; transform: scale(0); animation: ripple-anim 0.6s linear; pointer-events: none; }
        .back-btn { cursor: pointer; color: var(--text-sub); font-size: 0.85rem; margin-bottom: 15px; display: inline-block; transition: 0.3s; opacity: 0.7; }
        .back-btn:hover { opacity: 1; color: var(--accent-cyan); transform: translateX(-3px); }
    </style>
</head>
<body>
    <div id="toast-msg"></div>
    <canvas id="snowCanvas"></canvas>

    <div class="fixed-menu">
        <div class="hamburger-btn" onclick="toggleMenu(event)">
            <i class="fas fa-bars"></i>
        </div>
        <div class="nav-dropdown" id="navDropdown">
            <a href="#home" onclick="scrollToSection('home')">Home</a>
            <a href="#about" onclick="scrollToSection('about')">Info</a>
            <a href="#dns-setup" onclick="scrollToSection('dns-setup')">Locket Gold</a>
            <a href="#contact" onclick="scrollToSection('contact')">Contact</a>
            <a href="#donate" onclick="scrollToSection('donate')">Donate</a>
            <a href="#skills" onclick="scrollToSection('skills')">Skills</a>
            <a href="#playlist" onclick="scrollToSection('playlist')">Playlist</a>
        </div>
    </div>

    <div class="container">
        <section id="home" class="hero" style="animation-delay: 0.1s;">
            <div class="avatar-box">
                <img src="https://sf-static.upanhlaylink.com/img/image_20251215e9daf97bd6f701c3e0abbb4daeb76c2e.jpg" alt="Avatar" class="avatar">
            </div>
            <h1>DShinee</h1>
            <p>Fullstack Developer & Database Designer</p>
            <div class="social-links">
                <a href="https://www.facebook.com/dn.12th7" class="social-btn" title="Facebook"><i class="fab fa-facebook-f"></i></a>
                <a href="2Fspotify.com/0" class="social-btn" title="Spotify"><i class="fab fa-spotify"></i></a>
                <a href="https://locket.camera/links/rXf6HpKBU3c4czw57" class="social-btn" title="Locket"><i class="fas fa-heart"></i></a>
                <a href="https://tiktok.com/@hihihehe_123hihi" class="social-btn" title="TikTok"><i class="fab fa-tiktok"></i></a>
                <a href="https://instagram.com//dn_12th7" class="social-btn" title="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="#" class="social-btn" title="Github"><i class="fab fa-github"></i></a>
            </div>
        </section>

        <section id="about" class="glass-card" style="animation-delay: 0.2s;">
            <h2 class="section-title">System.Info</h2>
            <p style="color:var(--text-sub); line-height: 1.6;">Hi, My name is DShinee.<br>I'm Developer<br>...<br>Hello World.</p>
        </section>

        <section id="dns-setup" class="glass-card" style="animation-delay: 0.3s;">
            <h2 class="section-title">Locket Gold - DShinee</h2>
            <div id="deviceSelection" style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                <p style="color:var(--text-sub); text-align: center;">Vui lòng chọn thiết bị hoặc phương thức</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <div class="install-btn btn-effect" onclick="initKeyCheck('ios')" style="padding: 15px 30px; flex-direction: column; gap: 10px;">
                        <i class="fab fa-apple" style="font-size: 2rem;"></i> Thiết bị IOS
                    </div>
                    <div class="install-btn btn-effect" style="padding: 15px 30px; flex-direction: column; gap: 10px; background: linear-gradient(135deg, #3ddc84 0%, #21ad5c 100%);" onclick="initKeyCheck('android')">
                        <i class="fab fa-android" style="font-size: 2rem;"></i> Thiết bị Android
                    </div>
                    
                    <div class="install-btn btn-effect" style="padding: 15px 30px; flex-direction: column; gap: 10px; background: linear-gradient(135deg, #a855f7 0%, #ec4899 100%);" onclick="showUsernameInput()">
                        <i class="fas fa-user-plus" style="font-size: 2rem;"></i> Up Locket Gold Bằng Username
                    </div>
                </div>
            </div>

            <div id="usernameFlow">
                <span class="back-btn" onclick="resetSelection()">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </span>
                <div style="text-align: center;">
                    <h3 style="color:var(--text-main); margin-bottom:15px">Locket Gold Version New 2026</h3>
                    <p style="color:var(--text-sub); font-size:0.9rem; margin-bottom:15px">Up Locket Gold chỉ với 15 giây.</p>
                    <input type="text" id="locketUsername" class="key-input" placeholder="Nhập Username Locket..." style="max-width: 300px; margin: 0 auto 15px;">
                    <br>
                    <div class="install-btn" onclick="submitLocketUsername()">
                        <i class="fas fa-paper-plane"></i> Xác nhận
                    </div>
                    <p id="submitStatus" style="margin-top:15px; font-size: 0.9rem;"></p>
                </div>
            </div>

            <div id="iosFlow" style="display:none;">
                <span class="back-btn" onclick="resetSelection()">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </span>
                <div id="iosStep1" style="text-align: center;">
                    <p style="color:var(--text-sub); margin-bottom: 15px;">✦ IOS DNS Setup ✦</p>
                    <div class="install-btn" onclick="onStartIOS()">
                        <i class="fas fa-download"></i> Cài đặt ngay
                    </div>
                </div>
                <div id="dnsVideoStage">
                    <div class="video-wrapper">
                        <iframe id="dnsIframe" style="width: 100%; height: 200px;" frameborder="0" allow="autoplay"></iframe>
                    </div>
                    <div class="install-btn" style="margin-top: 15px;" onclick="onFinishDNSVideo()">Đã xem xong</div>
                </div>
                <div id="addConfigStage">
                    <h3 style="color:var(--text-main); margin-bottom: 15px;">Thêm Config Locket Gold</h3>
                    <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap;">
                        <div class="install-btn" onclick="onAddPublicConfig()">Config Public</div>
                        <div class="install-btn" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);" onclick="initKeyCheck('private_config')">Config Private</div>
                    </div>
                </div>
                <div id="srVideoStage">
                    <div class="video-wrapper">
                        <iframe id="srIframe" style="width: 100%; height: 200px;" frameborder="0"></iframe>
                    </div>
                    <div class="install-btn" style="margin-top: 15px;" onclick="resetSelection()">Hoàn thành</div>
                </div>
            </div>

            <div id="androidFlow" style="display:none; text-align: center;">
                <span class="back-btn" onclick="resetSelection()" style="display: block; text-align: left;">
                    <i class="fas fa-arrow-left"></i> Quay lại
                </span>
                <p style="color:var(--text-sub); margin-bottom: 20px;">✦ Android Locket Gold ✦</p>
                <a id="androidFinalBtn" href="#" class="install-btn" style="background: linear-gradient(135deg, #3ddc84 0%, #21ad5c 100%);">
                    <i class="fab fa-android"></i> Cài đặt Locket Gold Android
                </a>
            </div>
        </section>

        <section id="contact" class="glass-card" style="animation-delay: 0.35s;">
            <h2 class="section-title">Contact & Support</h2>
            <div style="display: flex; flex-direction: column; align-items: center; text-align: center; gap: 15px;">
                <p style="color:var(--text-sub); font-size: 0.95rem; line-height: 1.5;">Bạn gặp sự cố khi cài đặt hoặc muốn mua Key?<br>Kết nối với mình qua các kênh dưới đây.</p>
                <div style="display: flex; gap: 15px; flex-wrap: wrap; justify-content: center;">
                    <a href="https://m.me/dn.12th7" target="_blank" class="install-btn btn-effect" style="background: linear-gradient(135deg, #0084FF 0%, #00DF9A 100%);"><i class="fab fa-facebook-messenger"></i> Messenger</a>
                    <a href="https://zalo.me/0833685262" target="_blank" class="install-btn btn-effect" style="background: linear-gradient(135deg, #0068FF 0%, #00B4FB 100%);"><i class="fas fa-comment-dots"></i> Zalo Support</a>
                </div>
            </div>
        </section>

        <section id="donate" class="glass-card" style="animation-delay: 0.4s;">
            <h2 class="section-title">Donate - Support Me</h2>
            <div style="display: flex; flex-direction: column; align-items: center; text-align: center; gap: 15px;">
                <p style="color:var(--text-sub); font-size: 0.95rem;">Nếu bạn cảm thấy dự án hữu ích, hãy mời mình một ly cafe nhé! ☕</p>
                <div id="donateBtnBox">
                    <div class="install-btn" onclick="toggleDonate()"><i class="fas fa-coffee"></i> Donate</div>
                </div>
                <div id="donateArea">
                    <div class="qr-card">
                        <img id="qrImage" src="https://sf-static.upanhlaylink.com/img/image_2025122250facdb705f6d3dc657195e21be30052.jpg" alt="Mã QR Donate" class="qr-img">
                        <div class="bank-info">
                            <div class="bank-item">Ngân hàng: <b>MB BANK</b></div>
                            <div class="bank-item">Chủ TK: <b>NGUYEN VAN DUNG</b></div>
                            <div class="bank-item">Số TK: <b>83865888888</b></div>
                        </div>
                        <button class="install-btn sm" onclick="downloadQR()"><i class="fas fa-share-square"></i> Lưu / Chia sẻ QR</button>
                    </div>
                </div>
            </div>
        </section>

        <section id="skills" class="glass-card" style="animation-delay: 0.5s;">
            <h2 class="section-title">My Skills</h2>
            <div class="skills-grid">
                <span class="skill-tag">HTML5 / CSS3</span>
                <span class="skill-tag">JavaScript (ES6+)</span>
                <span class="skill-tag">Next.js / React</span>
                <span class="skill-tag">Python</span>
                <span class="skill-tag">Database Design</span>
                <span class="skill-tag">Git / Github</span>
            </div>
        </section>

        <section id="playlist" class="glass-card" style="animation-delay: 0.6s;">
            <h2 class="section-title">My Playlist</h2>
            <div class="music-player">
                <div class="disk" id="disk"></div>
                <div class="player-info">
                    <div class="song-info">
                        <h3 id="songTitle">Loading...</h3>
                        <p id="songArtist">Loading...</p>
                    </div>
                    <div class="progress-container" id="progressContainer">
                        <div class="progress-bar" id="progressBar"></div>
                    </div>
                    <div class="time-box">
                        <span id="currTime">0:00</span>
                        <span id="durTime">0:00</span>
                    </div>
                </div>
                <div class="controls">
                    <button class="control-btn" id="playBtn"><i class="fas fa-play" id="playIcon"></i></button>
                    <button class="control-btn secondary" id="nextBtn"><i class="fas fa-forward"></i></button>
                </div>
                <audio id="audio"></audio>
            </div>
        </section>

        <footer>
            <p>© 2026 Design By DShinee.</p>
        </footer>
    </div>

    <div class="modal-overlay" id="modalOverlay">
        <div class="glass-card modal-content">
            <h3>Xác thực hệ thống</h3>
            <input type="text" id="licenseKey" class="key-input" placeholder="Nhập Key Install...">
            <div class="modal-btn-group">
                <button class="modal-btn btn-cancel" onclick="closeKeyModal()">Hủy</button>
                <button class="modal-btn btn-confirm" onclick="verifyLicenseKey()">Xác nhận</button>
            </div>
        </div>
    </div>

    <script src="https://www.youtube.com/iframe_api"></script>
    <script src="database.js"></script>
    <script>
        var PRIVATE_CONFIG_KEY = "DShinee";  
        var PRIVATE_CONFIG_LINK = "shadowrocket://config/add/https://raw.githubusercontent.com/dungnguyen0537/Module/refs/heads/main/LKG_HNhung_ByDShinee.sgmodule";
        
        // LINK CỦA BẠN (ĐÃ GIỮ NGUYÊN)
        var GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwQwdBT3veelsiIcFQwuwX4byCFsB4IRqCrMcLVs0h83rhe9rn6IBp9YAXEQ0Mf8EgFng/exec";

        const isMob = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        if (!isMob) {
            document.addEventListener('keydown', function(e) {
                if (e.keyCode === 123 || (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 74 || e.keyCode === 67)) || (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83))) {
                    e.preventDefault();
                    return false;
                }
            });
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
                return false;
            });
        }

        const DNS_VID = "CqWbxsWmLtQ", SR_VID = "9BQdGlMAw-k";
        let curMode = null, ytP;

        // --- HÀM SHOW TOAST ĐƯỢC SỬA (THÊM THAM SỐ isSuccess) ---
        function showToast(m, isSuccess = false) {
            const t = document.getElementById("toast-msg");
            t.innerHTML = m;
            
            if (isSuccess) {
                t.classList.add("success");
            } else {
                t.classList.remove("success");
            }

            t.classList.add("show");
            setTimeout(() => { t.classList.remove("show"); }, 3000);
        }
        // ---------------------------------------------------------

        function initKeyCheck(m) {
            curMode = m;
            document.getElementById("modalOverlay").style.display = "flex";
            document.getElementById("licenseKey").value = "";
        }

        function closeKeyModal() {
            document.getElementById("modalOverlay").style.display = "none";
        }

        function verifyLicenseKey() {
            const k = document.getElementById("licenseKey").value.trim();
            if (curMode === 'private_config') {
                if (k === PRIVATE_CONFIG_KEY) {
                    closeKeyModal();
                    window.location.href = PRIVATE_CONFIG_LINK;
                    onFinishConfigStep();
                } else {
                    showToast("Key Private không chính xác !!!");
                }
                return;
            }
            if (typeof VALID_KEYS !== "undefined" && VALID_KEYS.includes(k)) {
                closeKeyModal();
                document.getElementById("deviceSelection").style.display = "none";
                if (curMode === 'ios') {
                    document.getElementById("iosFlow").style.display = "block";
                } else {
                    document.getElementById("androidFlow").style.display = "block";
                    document.getElementById("androidFinalBtn").href = "https://github.com/dungnguyen0537/DShinee/releases/download/v1.0/Locket_Gold_v1.210.4.apk";
                }
            } else {
                showToast("Key không chính xác !!! <br> Vui lòng liên hệ Admin để lấy Key !!!");
            }
        }

        function showUsernameInput() {
            document.getElementById("deviceSelection").style.display = "none";
            document.getElementById("usernameFlow").style.display = "block";
            document.getElementById("submitStatus").innerText = "";
        }

        async function submitLocketUsername() {
            const username = document.getElementById("locketUsername").value.trim();
            const statusEl = document.getElementById("submitStatus");

            if (!username) {
                showToast("Vui lòng nhập Username!");
                return;
            }
            
            if(username.length < 3) {
                 showToast("Username không hợp lệ!");
                 return;
            }

            statusEl.innerText = "Đang gửi dữ liệu...";
            statusEl.style.color = "#bae6fd";

            try {
                let ip = "Unknown";
                try {
                    const ipRes = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipRes.json();
                    ip = ipData.ip;
                } catch (e) { console.log("Không lấy được IP"); }

                const device = navigator.userAgent; 
                const time = new Date().toLocaleString('vi-VN'); 

                if(!GOOGLE_SCRIPT_URL || GOOGLE_SCRIPT_URL.includes("DÁN_LINK")) {
                    alert("Bạn chưa cấu hình link Google Apps Script trong code!");
                    return;
                }

                const finalUrl = `${GOOGLE_SCRIPT_URL}?time=${encodeURIComponent(time)}&username=${encodeURIComponent(username)}&ip=${encodeURIComponent(ip)}&device=${encodeURIComponent(device)}`;
                
                await fetch(finalUrl, { mode: 'no-cors' });

                // --- SỬ DỤNG HÀM MỚI VỚI THAM SỐ TRUE (HIỆN MÀU XANH) ---
                showToast("Đã gửi yêu cầu thành công!", true);
                // --------------------------------------------------------

                statusEl.innerHTML = "<i class='fas fa-check-circle'></i> Gửi thành công! Vui lòng liên hệ Admin để tiến hành nâng cấp.";
                statusEl.style.color = "#4ade80";
                document.getElementById("locketUsername").value = "";

            } catch (err) {
                console.error(err);
                showToast("Lỗi kết nối!"); // Mặc định là false (màu đỏ)
                statusEl.innerText = "Có lỗi xảy ra. Thử lại sau.";
                statusEl.style.color = "#ef4444";
            }
        }

        function resetSelection() {
            document.getElementById("iosFlow").style.display = "none";
            document.getElementById("androidFlow").style.display = "none";
            document.getElementById("usernameFlow").style.display = "none"; 
            document.getElementById("deviceSelection").style.display = "flex";
            document.getElementById("iosStep1").style.display = "block";
            document.getElementById("dnsVideoStage").style.display = "none";
            document.getElementById("addConfigStage").style.display = "none";
            document.getElementById("srVideoStage").style.display = "none";
            document.getElementById("dnsIframe").src = "";
            document.getElementById("srIframe").src = "";
        }

        function onStartIOS() {
            window.location.href = "DNSByDShinee.mobileconfig";
            setTimeout(() => {
                document.getElementById("iosStep1").style.display = "none";
                document.getElementById("dnsVideoStage").style.display = "block";
                document.getElementById("dnsIframe").src = `https://www.youtube.com/embed/${DNS_VID}?autoplay=1`;
            }, 1000);
        }

        function onFinishDNSVideo() {
            document.getElementById("dnsVideoStage").style.display = "none";
            document.getElementById("addConfigStage").style.display = "block";
        }

        function onAddPublicConfig() {
            window.location.href = "shadowrocket://config/add/https://raw.githubusercontent.com/dungnguyen0537/Module/refs/heads/main/Locket_ByDungNguyen.sgmodule";
            onFinishConfigStep();
        }

        function onFinishConfigStep() {
            setTimeout(() => {
                document.getElementById("addConfigStage").style.display = "none";
                document.getElementById("srVideoStage").style.display = "block";
                document.getElementById("srIframe").src = `https://www.youtube.com/embed/${SR_VID}?autoplay=1`;
            }, 1000);
        }

        function toggleDonate() {
            const d = document.getElementById('donateArea');
            d.style.display = (d.style.display === 'block') ? 'none' : 'block';
            if (d.style.display === 'block') d.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function toggleMenu(e) {
            if (e) e.stopPropagation();
            const d = document.getElementById('navDropdown');
            d.style.display = (d.style.display === 'flex') ? 'none' : 'flex';
        }

        function scrollToSection(id) {
            const e = document.getElementById(id);
            if (e) {
                e.scrollIntoView({ behavior: 'smooth', block: 'center' });
                document.getElementById('navDropdown').style.display = 'none';
            }
        }

        async function downloadQR() {
            const img = document.getElementById('qrImage');
            try {
                const res = await fetch(img.src);
                const blob = await res.blob();
                const file = new File([blob], 'QR_Donate.jpg', { type: blob.type });
                if (navigator.canShare && navigator.canShare({ files: [file] })) await navigator.share({ files: [file], title: 'QR' });
                else {
                    const u = URL.createObjectURL(blob), a = document.createElement('a');
                    a.href = u;
                    a.download = 'QR.jpg';
                    a.click();
                    URL.revokeObjectURL(u);
                }
            } catch (e) { window.open(img.src, '_blank'); }
        }

        const pl = [{ title: "Không Buông Drill", artist: "Hngle x Ari", src: "https://files.catbox.moe/9adi9p.mp3" }, { title: "Em", artist: "Binz", src: "https://files.catbox.moe/vs0z1h.mp3" }, { title: "Anh Đã Lớn Hơn", artist: "Dick", src: "https://files.catbox.moe/w9l7gb.mp3" }];
        let aud, st, sa, pb, pi, dk, pc, pbar, ct, dt, isP = false, idx = -1;

        function initAudio() {
            aud = document.getElementById('audio');
            st = document.getElementById('songTitle');
            sa = document.getElementById('songArtist');
            pb = document.getElementById('playBtn');
            pi = document.getElementById('playIcon');
            dk = document.getElementById('disk');
            pc = document.getElementById('progressContainer');
            pbar = document.getElementById('progressBar');
            ct = document.getElementById('currTime');
            dt = document.getElementById('durTime');
            loadSong(0);
            pb.addEventListener('click', () => isP ? pauseS() : playS());
            document.getElementById('nextBtn').addEventListener('click', () => { loadSong(Math.floor(Math.random() * pl.length)); playS(); });
            aud.addEventListener('timeupdate', (e) => {
                const { duration, currentTime } = e.srcElement;
                pbar.style.width = `${(currentTime / duration) * 100}%`;
                ct.innerText = fmt(currentTime);
                dt.innerText = fmt(duration);
            });
            aud.addEventListener('ended', () => { loadSong(Math.floor(Math.random() * pl.length)); playS(); });
            pc.addEventListener('click', (e) => aud.currentTime = (e.offsetX / pc.clientWidth) * aud.duration);
        }

        function loadSong(i) {
            idx = i;
            st.innerText = pl[i].title;
            sa.innerText = pl[i].artist;
            aud.src = pl[i].src;
        }

        function playS() { aud.play(); isP = true; dk.style.animationPlayState = 'running'; pi.className = 'fas fa-pause'; }
        function pauseS() { aud.pause(); isP = false; dk.style.animationPlayState = 'paused'; pi.className = 'fas fa-play'; }
        function fmt(s) { const m = Math.floor(s / 60), s2 = Math.floor(s % 60); return `${m}:${s2 < 10 ? '0' + s2 : s2}`; }

        function initSnow() {
            const c = document.getElementById("snowCanvas"), t = c.getContext("2d");
            let w, h, p = [];
            function r() { w = window.innerWidth; h = window.innerHeight; c.width = w; c.height = h; }
            class S {
                constructor() { this.reset(); this.y = Math.random() * h; }
                reset() { this.x = Math.random() * w; this.y = -10; this.speed = Math.random() * 1.5 + .5; this.size = Math.random() * 2 + 1; this.opacity = Math.random() * .5 + .2; this.sway = Math.random() * .02 - .01; this.angle = Math.random() * Math.PI * 2; }
                update() { this.y += this.speed; this.angle += .02; this.x += Math.sin(this.angle) * .5 + this.sway; if (this.y > h) this.reset(); }
                draw() { t.beginPath(); t.arc(this.x, this.y, this.size, 0, 2 * Math.PI); t.fillStyle = `rgba(255,255,255,${this.opacity})`; t.fill(); }
            }
            window.addEventListener("resize", r); r();
            for (let i = 0; i < 80; i++) p.push(new S());
            (function a() { t.clearRect(0, 0, w, h); p.forEach(s => { s.update(); s.draw(); }); requestAnimationFrame(a); })();
        }

        setTimeout(() => { initAudio(); initSnow(); }, 500);

        const obs = new IntersectionObserver(e => {
            e.forEach(x => { if (x.isIntersecting) x.target.classList.add("visible"); });
        }, { threshold: .2 });
        document.querySelectorAll("section").forEach(s => obs.observe(s));
    </script>
</body>
</html>
